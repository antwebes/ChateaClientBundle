<?xml version="1.0" encoding="UTF-8" ?>

<container xmlns="http://symfony.com/schema/dic/services"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd">

		<parameters>
			<parameter key="antwebs_event_listener_authenticated.class">Ant\Bundle\ChateaClientBundle\EventListener\AuthenticatedListener</parameter>
		
		    <parameter key="antwebs_user_provider.class">Ant\Bundle\ChateaClientBundle\Security\User\ChateaUserProvider</parameter>
		    <parameter key="antwebes_user_authentication_provider.class">Ant\Bundle\ChateaClientBundle\Security\Provider\ChateaAuthenticationProvider</parameter>
		    <parameter key="antwebes_authentication.listener.class">Ant\Bundle\ChateaClientBundle\Security\Firewall\ChateaAuthenticationListener</parameter>
		    <parameter key="antwebes_user_checker.class">Ant\Bundle\ChateaClientBundle\Security\User\UserChecker</parameter>
		    <parameter key="antwebs.entry_point.class">Ant\Bundle\ChateaClientBundle\Security\EntryPoint\ChateaEntryPoint</parameter>
		</parameters>
		
		<services>
		
			<service id="antwebs_event_listener_authenticated.action_listener" class="%antwebs_event_listener_authenticated.class%" >
				<argument type="service" id="security.context" />
				<argument type="service" id="antwebes_chateaclient_lib.http_client" />
			    <tag name="kernel.event_listener" event="kernel.controller" method="onKernelController" />
			</service>		
			<service id="antwebs_user_provider" class="%antwebs_user_provider.class%">
				<argument type="service" id="antwebes_chateaclient_lib.http_client" />
				<argument type="string">%antwebs_chateaclient_client_id%</argument>				
				<argument type="string">%antwebs_chateaclient_secret%</argument>
				<argument type="service" id="antwebes_logger" />
			</service>
			
			<service id="antwebs.entry_point" class="%antwebs.entry_point.class%" public="false" abstract="true">
				<argument type="service" id="security.http_utils"/>				
			</service>
			
			<service id="antwebes_user_checker" class="%antwebes_user_checker.class%"></service>
        	                			
			<service id="antwebes_user_authentication_provider" class="%antwebes_user_authentication_provider.class%">
				<argument type="service" id="antwebs_user_provider" />
				<argument type="service" id="antwebes_user_checker" /> 
				<argument type="string">secured_area</argument>
				<argument type="service" id="antwebes_logger" />
			</service>
			
			<service id="antwebes_authentication.listener" class="%antwebes_authentication.listener.class%">
	            <argument type="service" id="security.context" />
	            <argument type="service" id="security.authentication.manager" />
	            <argument type="service" id="security.authentication.session_strategy" />
	            <argument type="service" id="security.http_utils" />
	            <argument type="string">secured_area</argument>
	            <argument type="service" id="antwebes_authentication.success_handler" />
	            <argument type="service" id="antwebes_authentication.failure_handler" />	            	            
				<argument type="collection" />
				<argument type="service" id="form.csrf_provider" />
				<argument type="service" id="antwebes_logger" />
				<argument type="service" id="event_dispatcher" on-invalid="null"/>					           	            	            
			</service>			
		</services>		
</container>    